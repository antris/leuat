<html>
<head>
  <link rel="stylesheet" href="leuat.css" type="text/css">
<body>
<h1>LEUAT</h1>
<form method="post" action="/leuka">
  <input name="team" id="team" placeholder="LEUKA TIIMI NIMI">
  <input name="vetaja" id="vetaja" placeholder="VETÄJÄN NIMI">
  <button id="leuka">LEUKA</button>
</form>
<ul id="leuat"></ul>
<script src="/socket.io/socket.io.js"></script>
<script src="Bacon.js"></script>
<script src="jquery.js"></script>
<script src="jquery.cookie.js"></script>
<script>
console.log("Veä jo!")
function fieldValue(field) {
  function getValue() { return field.value }
  return Bacon.fromEvent(field, "input")
    .map(getValue)
    .toProperty(getValue())
}
function storeCookie(field) {
  field.value = $.cookie(field.id) || ""
  fieldValue(field).onValue(function(value) {
    $.cookie(field.id, value)
  })
}
storeCookie(team)
storeCookie(vetaja)

var teamP = fieldValue(team)
var vetajaP = fieldValue(vetaja)
var validP = teamP
var dataP = Bacon.combineTemplate({ team: teamP, vetaja: vetajaP, leukoja: 1 })
var socket = io()

validP.not().onValue(function(disabled) { leuka.disabled = disabled })

Bacon.fromEvent(document.querySelector("#leuka"), "click")
  .doAction(".preventDefault")
  .filter(validP)
  .map(dataP)
  .onValue(function(data) {
    socket.emit("leuka", data)
  })
socket.emit("leuat")
Bacon.fromEvent(socket, "leuat")
  .onValue(function(list) {
    var $list = list.map(function(leuka) {
      return $("<li>")
        .append($("<span>").addClass("team").text(leuka._id))
        .append($("<span>").addClass("leukoja").text(leuka.leukoja))
    })
    $("#leuat").html($list)
  })
</script>
</body>
</html>
